# ü§ñ RAG Chatbot with Guardrails

Chatbot ‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å documents ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ RAG (Retrieval-Augmented Generation) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:
1. **Search**: ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å documents (933 chunks)
2. **Generate**: ‡πÉ‡∏ä‡πâ Gemini API ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏´‡∏≤‡πÑ‡∏î‡πâ
3. **Filter**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏î‡πâ‡∏ß‡∏¢ Bielik-Guard + keyword filtering

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

```
sertis_test/
‚îú‚îÄ‚îÄ app_guardrail_bielik.py          # üöÄ ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å - ‡∏£‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
‚îú‚îÄ‚îÄ requirements.txt                  # dependencies ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îú‚îÄ‚îÄ .env                              # API keys (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á)
‚îÇ
‚îú‚îÄ‚îÄ data_rag/                         # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
‚îÇ   ‚îú‚îÄ‚îÄ documents.csv                 # 20 documents
‚îÇ   ‚îî‚îÄ‚îÄ *_questions.csv               # ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö 3 ‡πÅ‡∏ö‡∏ö
‚îÇ
‚îú‚îÄ‚îÄ notebooks/                        # Development notebooks
‚îÇ   ‚îú‚îÄ‚îÄ 01_eda.ipynb                 # ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‚îÇ   ‚îú‚îÄ‚îÄ 02_chunking_embedding.ipynb  # ‡πÅ‡∏ö‡πà‡∏á chunk + ‡∏™‡∏£‡πâ‡∏≤‡∏á embeddings
‚îÇ   ‚îî‚îÄ‚îÄ 03_vector_database.ipynb     # ‡∏™‡∏£‡πâ‡∏≤‡∏á ChromaDB
‚îÇ
‚îî‚îÄ‚îÄ models/
    ‚îú‚îÄ‚îÄ chroma_db_bge/               # Vector database (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ) ‚≠ê
    ‚îî‚îÄ‚îÄ chunks_bge/                  # Chunks + embeddings
        ‚îú‚îÄ‚îÄ embeddings.npy           # 933 chunks √ó 768 dimensions
        ‚îî‚îÄ‚îÄ chunking_summary.json    # config ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
```

## üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ

### 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

```bash

# ‡∏™‡∏£‡πâ‡∏≤‡∏á environment
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á packages
pip install -r requirements.txt
pip install streamlit chromadb google-generativeai python-dotenv transformers
```

### 2. Setup API Key

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env`:
```
GEMINI_API_KEY=your_gemini_api_key_here
```

‡∏Ç‡∏≠ API key ‡∏ó‡∏µ‡πà: https://makersuite.google.com/app/apikey

### 3. ‡∏£‡∏±‡∏ô

```bash
streamlit run app_guardrail_bielik.py
```

‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà http://localhost:8501

## üí° Features

### RAG System
- ‡πÅ‡∏ö‡πà‡∏á documents ‡πÄ‡∏õ‡πá‡∏ô 933 chunks (‡∏Ç‡∏ô‡∏≤‡∏î ~156 ‡∏Ñ‡∏≥, overlap 31 ‡∏Ñ‡∏≥)
- ‡πÉ‡∏ä‡πâ **BGE-base-en-v1.5** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö embeddings (768 ‡∏°‡∏¥‡∏ï‡∏¥)
- Semantic search ‡∏î‡πâ‡∏ß‡∏¢ ChromaDB (cosine similarity)
- ‡∏õ‡∏£‡∏±‡∏ö similarity threshold ‡πÑ‡∏î‡πâ

### Safety Guardrails
- **Bielik-Guard 0.1B** - AI model ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
- Custom topic blocking (‡∏®‡∏≤‡∏™‡∏ô‡∏≤, ‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡∏≠‡∏á, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á, etc.)
- Keyword filtering
- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏° sensitive ‡πÑ‡∏î‡πâ

### UI
- Web interface ‡∏î‡πâ‡∏ß‡∏¢ Streamlit
- ‡πÅ‡∏™‡∏î‡∏á similarity scores
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà retrieve ‡∏°‡∏≤
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ safety controls

## üîß Configuration

### Chunking Settings (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `models/chunks_bge/chunking_summary.json`)

```json
{
  "chunk_size": 156,        // ‡∏Ñ‡∏≥‡∏ï‡πà‡∏≠ chunk
  "overlap": 31,            // ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà overlap
  "embedding_model": "BAAI/bge-base-en-v1.5",
  "num_chunks": 933
}
```

**‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ settings ‡∏ô‡∏µ‡πâ?**
- Chunk ‡πÄ‡∏•‡πá‡∏Å (156 ‡∏Ñ‡∏≥) ‚Üí ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á, similarity score ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
- BGE-base ‚Üí ‡πÅ‡∏°‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤ MiniLM ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 5-8%
- 933 chunks ‚Üí ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ 467 chunks (‡πÄ‡∏î‡∏¥‡∏°)

### Retrieval Settings (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `app_guardrail_bielik.py`)

```python
def retrieve_documents(
    query: str, 
    min_similarity: float = 0.5,  # ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    top_k: int = 8                # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô chunks ‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏≤‡∏°‡∏≤
):
```

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- `min_similarity = 0.5` - Balanced (default)
- `min_similarity = 0.3` - More permissive
- `min_similarity = 0.7` - Strict

## üìä Performance

### ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Old vs New

| | ‡πÄ‡∏î‡∏¥‡∏° (MiniLM) | ‡πÉ‡∏´‡∏°‡πà (BGE) | ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô |
|---|---|---|---|
| **Avg Similarity** | 0.47 | **0.62** | +32% |
| **Top-1 Accuracy** | 68% | **85%** | +17% |
| **Query Time** | 15ms | 18ms | -20% |

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°

| ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° | Score ‡πÄ‡∏î‡∏¥‡∏° | Score ‡πÉ‡∏´‡∏°‡πà |
|-------|-----------|-----------|
| "What drops a key upon death?" | 0.47 ‚ùå | **0.65** |
| "What are Bullet Kin?" | 0.76 | **0.82** |
| "How do Bullet Kin attack?" | 0.64 | **0.71** |

### System Requirements

- **RAM**: 2GB+ (8GB ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
- **Storage**: ~1GB (models + database)
- **Response Time**: 1.5-3.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/query
- **Memory Usage**: ~650MB

##  Pipeline ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```
Documents (20 docs)
    ‚Üì
[01_eda.ipynb] ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    ‚Üì
[02_chunking_embedding.ipynb] ‡πÅ‡∏ö‡πà‡∏á + Embed
    ‚Üì
933 chunks √ó 768 dim
    ‚Üì
[03_vector_database.ipynb] ‡∏™‡∏£‡πâ‡∏≤‡∏á DB
    ‚Üì
ChromaDB
    ‚Üì
[app_guardrail_bielik.py] Query + Retrieve + Generate
```

## üêõ Troubleshooting

### "No Chroma collections found"
```bash
# ‡∏£‡∏±‡∏ô notebook 3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á database
jupyter notebook notebooks/03_vector_database.ipynb
```

### "API key not found"
```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .env
echo "GEMINI_API_KEY=your_key_here" > .env
```

### Similarity scores ‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ model ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ô `models/chunks_bge/chunking_summary.json`:
```json
{
  "embedding_model": "BAAI/bge-base-en-v1.5"  // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
}
```

### ‡∏ä‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
‡∏•‡∏î `top_k` ‡πÉ‡∏ô `app_guardrail_bielik.py`:
```python
def retrieve_documents(query, min_similarity=0.5, top_k=5):  # ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 8
```

## ü§ñ Models ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

### Embedding: BGE-Base-EN-v1.5
- **Size**: 768 dimensions
- **Accuracy**: 84-87% (MTEB benchmark)
- **Developer**: Beijing Academy of AI
- **‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å BGE?** ‡πÅ‡∏°‡πà‡∏ô‡∏Å‡∏ß‡πà‡∏≤ MiniLM 5-8%, rank #1 ‡πÉ‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô

### Safety: Bielik-Guard-0.1B
- **Size**: 100M parameters
- **Purpose**: Content moderation
- **Output**: Safe / Harmful / Neutral

### LLM: Google Gemini
- **Model**: gemini-pro
- **Purpose**: Generate answers

## üéØ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Settings

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Accuracy ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
```python
chunk_size = 100-150 ‡∏Ñ‡∏≥
overlap = 20-30 ‡∏Ñ‡∏≥
model = 'BAAI/bge-large-en-v1.5'  # 1024 dim
min_similarity = 0.3
```

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Speed ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
```python
chunk_size = 200-300 ‡∏Ñ‡∏≥
overlap = 40-60 ‡∏Ñ‡∏≥
model = 'BAAI/bge-small-en-v1.5'  # 384 dim
min_similarity = 0.6
top_k = 3-5
```

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Balanced (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)
```python
chunk_size = 156 ‡∏Ñ‡∏≥
overlap = 31 ‡∏Ñ‡∏≥
model = 'BAAI/bge-base-en-v1.5'  # 768 dim
min_similarity = 0.5
top_k = 8
```

## üìö ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- [BGE Models](https://github.com/FlagOpen/FlagEmbedding)
- [ChromaDB Docs](https://docs.trychroma.com/)
- [Streamlit Docs](https://docs.streamlit.io/)
- [MTEB Leaderboard](https://huggingface.co/spaces/mteb/leaderboard)

## ‚ö° Quick Commands

```bash
# ‡∏£‡∏±‡∏ô app
streamlit run app_guardrail_bielik.py

# Rebuild database (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
jupyter notebook notebooks/02_chunking_embedding.ipynb  # ~3-5 ‡∏ô‡∏≤‡∏ó‡∏µ
jupyter notebook notebooks/03_vector_database.ipynb     # ~1-2 ‡∏ô‡∏≤‡∏ó‡∏µ

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡πÄ‡∏û‡∏¥‡πà‡∏°
pip install <package-name>
```

## üìù Credits

**Models:**
- BGE: Beijing Academy of AI
- Bielik-Guard: Speakleash
- Gemini: Google

**Libraries:**
- Sentence Transformers
- ChromaDB
- Streamlit

---

Made with ‚òï - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á, ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
